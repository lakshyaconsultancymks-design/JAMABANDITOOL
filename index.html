<!DOCTYPE html>
<html>
<head>
    <title>Extract All Khasra Blocks (Merged PDF Support)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
</head>
<body>
<h2>Extract FIRST COLUMN Numbers From ALL Blocks (Merged PDF)</h2>
<input type="file" id="pdfFile" accept="application/pdf">
<pre id="output"></pre>

<script>
document.getElementById("pdfFile").addEventListener("change", async function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const buffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument(buffer).promise;

    let items = [];

    // Read all text items with coordinates
    for (let p = 1; p <= pdf.numPages; p++) {
        let page = await pdf.getPage(p);
        let text = await page.getTextContent();

        text.items.forEach(it => {
            items.push({
                str: it.str.trim(),
                x: it.transform[4],
                y: it.transform[5],
                page: p,
                order: items.length
            });
        });
    }

    const START = "खसरा संख्या";
    const END   = "कुल खसरे";

    let startIdx = [];
    let endIdx = [];

    items.forEach((it, i) => {
        if (it.str.includes(START)) startIdx.push(i);
        if (it.str.includes(END))   endIdx.push(i);
    });

    if (startIdx.length === 0 || endIdx.length === 0) {
        document.getElementById("output").textContent =
            "Keywords not found.";
        return;
    }

    let finalData = [];

    for (let s of startIdx) {
        let e = endIdx.find(x => x > s);
        if (!e) continue;

        let block = items.slice(s + 1, e);
        if (block.length === 0) continue;

        let minX = Math.min(...block.map(i => i.x));
        let firstCol = block.filter(i => Math.abs(i.x - minX) < 6);

        let nums = firstCol
            .map(i => i.str)
            .filter(v => /^[0-9]+(\/[0-9]+)?$/.test(v));

        if (nums.length > 0) {
            finalData.push(...nums);
        }
    }

    // FINAL OUTPUT WITH ONLY COMMA (NO SPACE)
    document.getElementById("output").textContent =
        finalData.join(",");
});
</script>
</body>
</html>
